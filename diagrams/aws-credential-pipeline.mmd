graph TD
    subgraph CLIENT["<b>Client Machine</b> &nbsp;(Windows)"]
        direction TB
        L1["<b>Layer 1:</b> SessionStart Hook<br/><i>check-aws-sso.js</i>"]
        L1A["Validates local AWS SSO session"]
        L1B["Auto-refreshes if expired"]
        L1C["Runs every time Claude Code starts"]

        L2["<b>Layer 2:</b> SessionStart Hook<br/><i>push-aws-to-gcp.js</i>"]
        L2A["Reads local AWS credentials"]
        L2B["Pushes to GCP VM via PowerShell"]
        L2C["Updates .env + recreates container"]

        L3["<b>Layer 3:</b> Windows Scheduled Task<br/><i>Hindsight-AWS-Credential-Push</i>"]
        L3A["Triggers on user login"]
        L3B["Pushes fresh creds without Claude"]

        L1 --> L1A & L1B & L1C
        L2 --> L2A & L2B & L2C
        L3 --> L3A & L3B
    end

    subgraph GCP["<b>GCP VM</b> &nbsp;(hindsight-vm)"]
        direction TB
        SCRIPT["Auto-Push-AWS-Credentials.ps1"]
        ENV["Writes credentials to .env"]
        DOCKER["docker compose up -d<br/>--force-recreate litellm-proxy"]

        SCRIPT --> ENV --> DOCKER
    end

    CLIENT -->|"SSH + script execution"| GCP

    style CLIENT fill:#e8f5e9,stroke:#2e7d32,stroke-width:2px,color:#1a1a1a
    style GCP fill:#e3edf7,stroke:#2c5f8a,stroke-width:2px,color:#1a1a1a
    style L1 fill:#66bb6a,stroke:#2e7d32,color:#fff
    style L2 fill:#66bb6a,stroke:#2e7d32,color:#fff
    style L3 fill:#66bb6a,stroke:#2e7d32,color:#fff
    style SCRIPT fill:#4A90D9,stroke:#2c5f8a,color:#fff
    style DOCKER fill:#4A90D9,stroke:#2c5f8a,color:#fff
